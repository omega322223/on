<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Balanced Image Tier List Maker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f1f5f9; }
        
        /* ë ˆì´ì•„ì›ƒ */
        #capture-container { padding: 30px; background: white; border-radius: 12px; display: inline-block; min-width: 100%; box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1); }
        #tier-table { border-collapse: separate; border-spacing: 0; width: 100%; table-layout: fixed; border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden; }
        th, td { border: 1px solid #e2e8f0; position: relative; vertical-align: top; }
        
        /* í…ìŠ¤íŠ¸ ì…ë ¥ì°½ (ë°°ìœ¨ ì¡°ì •) */
        .cell-input { width: 100%; border: none; background: transparent; text-align: center; outline: none; padding: 2px 2px; }
        .model-name { font-weight: 700; font-size: 12px; color: #1e293b; margin-top: 4px; }
        .model-desc { font-size: 10px; color: #64748b; }

        /* --- ì´ë¯¸ì§€ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì˜ì—­ ìŠ¤íƒ€ì¼ (ë°°ìœ¨ ì¡°ì •) --- */
        .model-cell { padding: 6px; transition: all 0.2s; } /* íŒ¨ë”© ì¶•ì†Œ */
        .image-drop-zone {
            width: 100%; height: 50px; /* ë†’ì´ë¥¼ 80pxì—ì„œ 50pxë¡œ ì¶•ì†Œ */
            border: 2px dashed #cbd5e1; border-radius: 6px;
            display: flex; justify-content: center; align-items: center;
            background-color: #f8fafc; color: #94a3b8; font-size: 10px;
            position: relative; overflow: hidden; transition: all 0.2s;
        }
        /* ë“œë˜ê·¸ ì˜¤ë²„ ì‹œ ê°•ì¡° */
        .model-cell.drag-over .image-drop-zone { border-color: #3b82f6; background-color: #eff6ff; color: #3b82f6; }
        /* ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
        .uploaded-image { width: 100%; height: 100%; object-fit: contain; padding: 2px; background: white; display: none; }
        .image-drop-zone.has-image .uploaded-image { display: block; }
        .image-drop-zone.has-image .placeholder-text { display: none; }
        .image-drop-zone.has-image { border-style: solid; border-color: transparent; background: transparent; }

        /* ì´ë¯¸ì§€ ì‚­ì œ ë²„íŠ¼ */
        .remove-img-btn {
            position: absolute; top: 2px; right: 2px;
            background: rgba(0,0,0,0.6); color: white; border-radius: 4px;
            width: 16px; height: 16px; font-size: 10px; line-height: 16px; text-align: center;
            cursor: pointer; opacity: 0; transition: opacity 0.2s;
        }
        .image-drop-zone.has-image:hover .remove-img-btn { opacity: 1; }

        /* --- ê¸°ì¡´ ë„êµ¬ ìŠ¤íƒ€ì¼ (ìƒ‰ìƒ, ì‚­ì œ ë“±) --- */
        .color-tool { position: absolute; bottom: 2px; right: 2px; display: flex; gap: 2px; opacity: 0; transition: opacity 0.2s; z-index: 10; }
        th:hover .color-tool, td:hover .color-tool { opacity: 1; }
        .color-picker-input { width: 16px; height: 16px; padding: 0; border: none; cursor: pointer; background: transparent; }
        .text-toggle-btn { background: rgba(255,255,255,0.8); border-radius: 2px; font-size: 8px; padding: 1px 3px; cursor: pointer; border: 1px solid #ccc; color: black; }
        .del-btn { position: absolute; top: -8px; right: -8px; background: #ef4444; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; opacity: 0; z-index: 20; }
        th:hover .del-btn, td:hover .del-btn { opacity: 1; }
        .no-capture { display: none !important; }

        /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
        #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 8px; padding: 16px; position: fixed; z-index: 100; left: 50%; bottom: 30px; transform: translateX(-50%); box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 3s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="toast">ë§í¬ ë³µì‚¬ ì™„ë£Œ! (ì´ë¯¸ì§€ëŠ” ê³µìœ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤)</div>

    <div class="max-w-[98%] mx-auto">
        <header class="mb-6 flex flex-col md:flex-row items-end justify-between gap-4">
            <div>
                <h1 class="text-3xl font-black text-gray-800 italic tracking-tight">RUNNING <span class="text-blue-600">IMAGE</span> TIER</h1>
                <p class="text-gray-500 text-sm mt-1">ì´ë¯¸ì§€ íŒŒì¼ì„ ì¹¸ì— ë“œë˜ê·¸í•˜ì—¬ ë‚˜ë§Œì˜ í‹°ì–´í‘œë¥¼ ì™„ì„±í•˜ì„¸ìš”.</p>
            </div>
            <div class="flex flex-wrap gap-2 bg-white p-2 rounded-xl shadow-sm">
                <button onclick="addBrand()" class="bg-gray-800 text-white px-4 py-2 rounded-lg font-bold text-xs hover:bg-black transition flex items-center">+ ë¸Œëœë“œ ì—´</button>
                <button onclick="addTier()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold text-xs hover:bg-blue-700 transition flex items-center">+ í‹°ì–´ í–‰</button>
                <div class="h-auto w-px bg-gray-200 mx-1"></div>
                <button onclick="generateShareLink()" class="bg-purple-100 text-purple-700 px-4 py-2 rounded-lg font-bold text-xs hover:bg-purple-200 transition flex items-center">ğŸ”— í…ìŠ¤íŠ¸ ê³µìœ  ë§í¬</button>
                <button onclick="downloadTable()" class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-xs hover:bg-green-700 transition shadow-sm flex items-center gap-1">
                    <span>ğŸ“¸ ì´ë¯¸ì§€ ì €ì¥</span>
                </button>
            </div>
        </header>

        <div id="capture-container">
            <table id="tier-table">
                <thead>
                    <tr id="header-row">
                        <th class="p-4 bg-gray-100 text-gray-500 text-[10px] font-black uppercase tracking-wider w-[120px] border-b-2 border-gray-200">Tier \ Brand</th>
                    </tr>
                </thead>
                <tbody id="tier-body">
                </tbody>
            </table>
        </div>
        <p class="text-center text-xs text-gray-400 mt-4">Tip: ì´ë¯¸ì§€ê°€ í¬í•¨ëœ í‘œëŠ” 'ê³µìœ  ë§í¬'ë¡œ ì „ë‹¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê¼­ 'ì´ë¯¸ì§€ ì €ì¥'ì„ ì´ìš©í•´ ì£¼ì„¸ìš”.</p>
    </div>

    <script>
        // ì´ˆê¸° ë°ì´í„°
        const defaultData = {
            brands: [{name: "ON RUNNING", bg: "#1e293b", text: "#ffffff"}, {name: "NIKE", bg: "#1e293b", text: "#ffffff"}, {name: "NEW BRAND", bg: "#1e293b", text: "#ffffff"}, {name: "NEW BRAND", bg: "#1e293b", text: "#ffffff"}, {name: "NEW BRAND", bg: "#1e293b", text: "#ffffff"}],
            tiers: [{name: "RACING", bg: "#fee2e2", text: "#b91c1c", cols: 5}, {name: "NEW TIER", bg: "#f1f5f9", text: "#475569", cols: 5}]
        };

        window.onload = () => {
            const hash = window.location.hash;
            if (hash) {
                try {
                    const decoded = JSON.parse(decodeURIComponent(escape(atob(hash.substring(1)))));
                    renderTable(decoded);
                } catch (e) { renderTable(defaultData); }
            } else { renderTable(defaultData); }
        };

        // ================= ì´ë¯¸ì§€ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê´€ë ¨ í•¨ìˆ˜ =================
        
        // ë“œë˜ê·¸ ì´ë²¤íŠ¸ ì„¤ì • (ì…€ ìƒì„± ì‹œ í˜¸ì¶œ)
        function setupDragEvents(cell) {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                cell.addEventListener(eventName, preventDefaults, false);
            });
            ['dragenter', 'dragover'].forEach(eventName => {
                cell.addEventListener(eventName, highlight, false);
            });
            ['dragleave', 'drop'].forEach(eventName => {
                cell.addEventListener(eventName, unhighlight, false);
            });
            cell.addEventListener('drop', handleDrop, false);
        }

        function preventDefaults(e) { e.preventDefault(); e.stopPropagation(); }
        function highlight(e) { this.closest('.model-cell').classList.add('drag-over'); }
        function unhighlight(e) { this.closest('.model-cell').classList.remove('drag-over'); }

        // íŒŒì¼ ë“œë¡­ ì²˜ë¦¬
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0 && files[0].type.startsWith('image/')) {
                const file = files[0];
                const dropZone = this.querySelector('.image-drop-zone');
                const img = dropZone.querySelector('.uploaded-image');
                
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onloadend = function() {
                    img.src = reader.result;
                    dropZone.classList.add('has-image');
                }
            }
        }

        // ì´ë¯¸ì§€ ì‚­ì œ í•¨ìˆ˜
        function removeImage(btn) {
            const dropZone = btn.closest('.image-drop-zone');
            const img = dropZone.querySelector('.uploaded-image');
            img.src = "";
            dropZone.classList.remove('has-image');
        }

        // ================= í…Œì´ë¸” ë Œë”ë§ ë° ì¡°ì‘ í•¨ìˆ˜ =================

        function renderTable(data) {
            document.getElementById('header-row').innerHTML = '<th class="p-4 bg-gray-100 text-gray-500 text-[10px] font-black uppercase tracking-wider w-[120px] border-b-2 border-gray-200">Tier \\ Brand</th>';
            document.getElementById('tier-body').innerHTML = '';
            data.brands.forEach(b => createBrandCell(b.name, b.bg, b.text));
            data.tiers.forEach(t => createTierRow(t.name, t.bg, t.text, t.cols || data.brands.length));
        }

        // ëª¨ë¸ ì…€ HTML ìƒì„± (ì´ë¯¸ì§€ ì˜ì—­ í¬í•¨)
        function getModelCellHtml() {
            return `
                <div class="image-drop-zone">
                    <span class="placeholder-text">ğŸ“· ì´ë¯¸ì§€ ë“œë˜ê·¸</span>
                    <img class="uploaded-image" src="" alt="uploaded">
                    <button class="remove-img-btn" onclick="removeImage(this)">âœ•</button>
                </div>
                <input type="text" class="cell-input model-name" placeholder="ëª¨ë¸ëª…">
                <input type="text" class="cell-input model-desc" placeholder="ì„¤ëª…">
            `;
        }

        function createBrandCell(name, bg, text) {
            const th = document.createElement('th');
            th.className = "brand-cell relative group p-2 border-b-2 border-gray-200";
            th.style.backgroundColor = bg; th.style.color = text;
            th.innerHTML = `<input type="text" class="cell-input font-black uppercase text-inherit" value="${name}"><div class="color-tool"><button class="text-toggle-btn" onclick="toggleText(this)">B/W</button><input type="color" class="color-picker-input" value="${bg}" oninput="changeBg(this)"></div><span onclick="removeColumn(this)" class="del-btn">Ã—</span>`;
            document.getElementById('header-row').appendChild(th);
        }

        function createTierRow(name, bg, text, colCount) {
            const tr = document.createElement('tr'); tr.className = "tier-row";
            let html = `<td class="tier-label-cell font-black p-2 relative group" style="background-color: ${bg}; color: ${text};"><input type="text" class="cell-input font-black text-inherit" value="${name}"><div class="color-tool"><button class="text-toggle-btn" onclick="toggleText(this)">B/W</button><input type="color" class="color-picker-input" value="${bg}" oninput="changeBg(this)"></div><span onclick="removeRow(this)" class="del-btn">Ã—</span></td>`;
            for (let i = 0; i < colCount; i++) {
                html += `<td class="model-cell">${getModelCellHtml()}</td>`;
            }
            tr.innerHTML = html;
            document.getElementById('tier-body').appendChild(tr);
            // ìƒˆë¡œ ìƒì„±ëœ ì…€ë“¤ì— ë“œë˜ê·¸ ì´ë²¤íŠ¸ ì—°ê²°
            tr.querySelectorAll('.model-cell').forEach(setupDragEvents);
        }

        function addBrand() {
            createBrandCell("NEW BRAND", "#1e293b", "#ffffff");
            document.querySelectorAll('.tier-row').forEach(row => {
                const td = document.createElement('td');
                td.className = "model-cell";
                td.innerHTML = getModelCellHtml();
                row.appendChild(td);
                setupDragEvents(td); // ì´ë²¤íŠ¸ ì—°ê²°
            });
        }

        function addTier() {
            const colCount = document.getElementById('header-row').cells.length - 1;
            createTierRow("NEW TIER", "#f1f5f9", "#475569", colCount);
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤ (ìƒ‰ìƒë³€ê²½, ì‚­ì œ, ê³µìœ , ë‹¤ìš´ë¡œë“œ)
        function changeBg(input) { (input.closest('th') || input.closest('td')).style.backgroundColor = input.value; }
        function toggleText(btn) { const cell = btn.closest('th') || btn.closest('td'); cell.style.color = (window.getComputedStyle(cell).color === 'rgb(255, 255, 255)') ? '#000000' : '#ffffff'; }
        function removeRow(btn) { btn.closest('tr').remove(); }
        function removeColumn(btn) { const index = btn.closest('th').cellIndex; document.querySelectorAll('tr').forEach(row => row.deleteCell(index)); }

        function generateShareLink() {
            // *ì¤‘ìš”* ê³µìœ  ë§í¬ ìƒì„± ì‹œ ì´ë¯¸ì§€ëŠ” ì œì™¸í•˜ê³  í…ìŠ¤íŠ¸ ë°ì´í„°ë§Œ ìˆ˜ì§‘í•©ë‹ˆë‹¤.
            const data = { brands: [], tiers: [] };
            const headers = document.querySelectorAll('#header-row th');
            for (let i = 1; i < headers.length; i++) { data.brands.push({ name: headers[i].querySelector('input').value, bg: headers[i].style.backgroundColor, text: headers[i].style.color }); }
            document.querySelectorAll('.tier-row').forEach(row => {
                const labelCell = row.cells[0];
                data.tiers.push({ name: labelCell.querySelector('input').value, bg: labelCell.style.backgroundColor, text: labelCell.style.color, cols: row.cells.length -1 });
            });
            const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
            navigator.clipboard.writeText(window.location.origin + window.location.pathname + "#" + encoded)
                .then(() => { showToast(); });
        }

        function showToast() { const toast = document.getElementById("toast"); toast.className = "show"; setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000); }

        async function downloadTable() {
            const container = document.getElementById('capture-container');
            const tools = document.querySelectorAll('.color-tool, .del-btn, .remove-img-btn, .placeholder-text'); // ìº¡ì²˜ ì‹œ ìˆ¨ê¸¸ ìš”ì†Œë“¤
            tools.forEach(el => el.classList.add('no-capture'));
            
            // ì´ë¯¸ì§€ ë¡œë”© ëŒ€ê¸° (ì•ˆì •ì ì¸ ìº¡ì²˜ë¥¼ ìœ„í•´)
            await new Promise(resolve => setTimeout(resolve, 500));

            const canvas = await html2canvas(container, { scale: 2, backgroundColor: '#ffffff', useCORS: true });
            tools.forEach(el => el.classList.remove('no-capture'));
            const link = document.createElement('a'); link.download = `running-tier-image-${Date.now()}.png`; link.href = canvas.toDataURL(); link.click();
        }
    </script>
</body>
</html>